<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="云逸'bolg" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="云逸'bolg" type="application/atom+xml"><link rel="alternate" type="application/json" title="云逸'bolg" href="http://gyzero.shop/feed.json"/><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.3.6"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><link rel="canonical" href="http://gyzero.shop/2024/03/05/network-security/neiwang/win%E5%8D%8F%E8%AE%AE/"><title>win协议认证知识</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">win协议认证知识</h1><div class="meta"><span class="item" title="创建时间：2024-03-05 14:48:19"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-03-05T14:48:19+08:00">2024-03-05</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>8.8k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>8 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">云逸'bolg</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/gyzero/33.jpg"></li><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/gyzero/99.jpg"></li><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/gyzero/9998.jpg"></li><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%A3%81%E7%BA%B8/45.jpg"></li><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/gyzero/88.jpg"></li><li class="item" data-background-image="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/gyzero/oo.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/network-security/" itemprop="item" rel="index" title="分类于网络安全"><span itemprop="name">网络安全<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/network-security/neiwang/" itemprop="item" rel="index" title="分类于内网安全"><span itemprop="name">内网安全<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://gyzero.shop/2024/03/05/network-security/neiwang/win%E5%8D%8F%E8%AE%AE/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="云逸"/><meta itemprop="description" content=", "/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="云逸'bolg"/></span><div class="body md" itemprop="articleBody"><h2 id="ntlm协议"><a class="markdownIt-Anchor" href="#ntlm协议">#</a> NTLM 协议</h2>
<p>NTLM（NT LAN Manager）是一套由微软开发的安全协议套件，用于在基于 Windows 的网络中进行身份验证、完整性和机密性保护。NTLM 最初是在上世纪 90 年代初引入的，经过多次修订以增强安全性和功能现在已经更新了 NTMLv2 和 kerberos 协议。</p>
<h3 id="ntlm-hash"><a class="markdownIt-Anchor" href="#ntlm-hash">#</a> NTLM HASH</h3>
<p>NT LAN Manager</p>
<p>长度为 32 位由数字字母组成是认证时的一个重要参照物</p>
<p>在 windows 中我们的密码通常不是以明文形式传输，而是以哈希值的形式。例如我们设置密码为 admin 密码就会被哈希处理保存在 SAM 数据库中当用户登录时，其密码首先被哈希处理，然后与存储在系统中的哈希值进行比较。</p>
<p>SAM 文件存储位置 <code>C:\Windows\System32\config\SAM</code>  是需要系统管理员权限才可以访问查看</p>
<p><img data-src="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%86%85%E7%BD%91/%E5%9F%9F/image-20240305152021162.png" alt="image-20240305152021162"></p>
<h3 id="本地认证流程"><a class="markdownIt-Anchor" href="#本地认证流程">#</a> 本地认证流程</h3>
<ol>
<li><strong>用户登录</strong>：当用户尝试登录到 Windows 系统时由 winlogon.exe 管理。</li>
<li><strong>接收用户输入</strong>：用户在登录界面输入用户名和密码。winlogon.exe 负责接收这些用户输入。</li>
<li><strong>验证用户凭据</strong>：一旦用户输入了凭据，winlogon.exe 将这些凭据传递给 Local Security Authority Subsystem Service (LSASS)，也就是 lsass.exe。</li>
<li><strong>认证过程</strong>: lsass.exe 将收到的用户凭据与本地存储的凭据进行比对，这些凭据通常以 NTLM hash 的形式存储在本地安全账户数据库中。lsass.exe 会使用 NTLM hash 算法来验证用户提供的凭据。</li>
<li><strong>访问授权</strong>：如果凭据验证成功，用户将被授权登录到系统，并获得相应的访问权限。如果验证失败，用户将被拒绝登录</li>
</ol>
<h3 id="ntlm认证详细流程"><a class="markdownIt-Anchor" href="#ntlm认证详细流程">#</a> NTLM 认证详细流程</h3>
<ol>
<li><strong>协商</strong>：客户端和服务器协商使用的 NTLM 协议版本。</li>
<li><strong>挑战 / 响应</strong>：服务器向客户端发送一个挑战，客户端以用户凭据的哈希版本进行响应。</li>
<li><strong>会话安全</strong>：如果凭证被验证，将建立一个用于客户端和服务器之间安全通信的会话密钥。</li>
</ol>
<h4 id="第一步先协商"><a class="markdownIt-Anchor" href="#第一步先协商">#</a> 第一步先协商</h4>
<ul>
<li>客户端发起连接请求，并包含支持的 NTLM 协议版本列表。</li>
<li>服务器从客户端提供的列表中选择最高版本的 NTLM 协议 v1,v2 或者更早的 LM 协议，并向客户端发送选定的协议版本</li>
</ul>
<h4 id="第二步挑战响应"><a class="markdownIt-Anchor" href="#第二步挑战响应">#</a> 第二步挑战 / 响应</h4>
<p>首先服务端接收到来自客服端的用户名 test，然后查询本地账户有没有这个 test 用户</p>
<blockquote>
<p>没有的话返回认证失败</p>
<p>有的话认证通过</p>
</blockquote>
<p>接着服务端生成一个 Challenge 这是一个 16 字节的随机数每次都不同，然后找到 test 的 NTLM HASH 值并用这个加密 Challenge</p>
<p>生成一个 net-NTLM-HASH 存在内存中</p>
<blockquote>
<p>将 Challenge 发送给客户端</p>
</blockquote>
<p>客户端接收到 Challenge 后将 test 的密码转换为 NTMLHASH 然后对 Challenge 加密生成响应 response 也就是 net-NTLM-HASH</p>
<blockquote>
<p>客户端的 response 发送给服务端</p>
</blockquote>
<p>服务端收到 response 后与之前的 net-NTLM-HASH 进行比较如果相同的话认证通过</p>
<blockquote>
<p>认证通过</p>
</blockquote>
<h3 id="ntlmv1和v2区别"><a class="markdownIt-Anchor" href="#ntlmv1和v2区别">#</a> NTLMv1 和 v2 区别</h3>
<ol>
<li><strong>安全性</strong>:
<ul>
<li>NTLMv1: NTLMv1 使用较弱的密码哈希算法（如 LM hash 和 NTLM hash），并且缺乏足够的随机性和安全性措施。它容易受到中间人攻击、字典攻击和重放攻击的影响。</li>
<li>NTLMv2: NTLMv2 引入了更强大的密码哈希算法，通常是使用更安全的算法，如 MD5 或 SHA-256。它还引入了更多的随机性和安全性措施，例如使用更复杂的挑战 / 响应过程，增加了消息完整性检查等。这使得 NTLMv2 比 NTLMv1 更难以被破解和攻击。</li>
</ul>
</li>
<li><strong>消息结构</strong>:
<ul>
<li>NTLMv1: NTLMv1 的消息结构相对简单，通常包括挑战和响应等基本部分。它的消息格式不够复杂，容易受到中间人攻击和重放攻击的影响。</li>
<li>NTLMv2: NTLMv2 引入了更复杂的消息结构，包括更多的字段和数据元素。它的消息结构更复杂，包含更多的随机数和安全性相关的字段，使得攻击者更难以破解或篡改通信内容。</li>
</ul>
</li>
<li><strong>兼容性</strong>:
<ul>
<li>NTLMv1: 尽管 NTLMv1 已被证明存在较大的安全风险，但仍然存在一些环境和遗留系统可能仍在使用 NTLMv1。一些旧版的 Windows 系统和应用程序仍然可能使用 NTLMv1，因此在某些情况下可能无法完全避免。</li>
<li>NTLMv2: NTLMv2 是更安全的选项，但需要双方都支持才能正常使用。在较新的 Windows 系统和网络环境中，NTLMv2 通常被推荐和优先使用，以提高系统的安全性和兼容性。</li>
</ul>
</li>
</ol>
<h3 id="ntlm-hash的安全问题"><a class="markdownIt-Anchor" href="#ntlm-hash的安全问题">#</a> NTLM-HASH 的安全问题</h3>
<ol>
<li><strong>弱密码哈希</strong>：NTLM Hash 使用的是较旧的哈希算法（如 MD4 或 MD5），这些算法已经被证明不安全，容易受到字典攻击、暴力破解等攻击。</li>
<li><strong>单向散列</strong>：NTLM Hash 是单向散列，即从密码计算出 Hash 值很容易，但从 Hash 值反推出原始密码非常困难。这导致了在没有盐（salt）的情况下，使用彩虹表等预先计算好的 Hash 值进行破解的可能性。</li>
<li><strong>中间人攻击</strong>：NTLM 协议本身容易受到中间人攻击的影响。攻击者可以拦截 NTLM 挑战 - 响应消息，并使用这些消息来模拟客户端与服务器之间的通信，从而获得对目标系统的访问权限。</li>
</ol>
<p><strong>Pass The Hash 攻击</strong>：攻击者可以获取到 NTLM Hash 后，直接使用这个 Hash 进行身份验证，而无需知道用户的明文密码</p>
<h2 id="kerberos协议"><a class="markdownIt-Anchor" href="#kerberos协议">#</a> Kerberos 协议</h2>
<p>Kerberos 是一种网络认证协议，其设计目标是通过系统为客户机 / 服务器应用程序提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下， Kerberos 作为一种可信任的第三方认证服务，是通过传统的（如：共享密钥）执行认证服务的。</p>
<p>麻省理工研发了 Kerberos 协议来保护 Project Athena 提供的网络服务器。这个协议以希腊神话中的人物 Kerberos 命名，他是一条凶猛的三头保卫神犬</p>
<h3 id="kerberos一些术语"><a class="markdownIt-Anchor" href="#kerberos一些术语">#</a> kerberos 一些术语</h3>
<ol>
<li><strong>AS（Authentication Server）- 认证服务器</strong>：
<ul>
<li>AS 是 Kerberos 协议中的组件，用于对用户进行身份验证。它负责接收用户的认证请求，并在验证用户身份后向用户颁发 TGT。</li>
</ul>
</li>
<li><strong>KDC（Key Distribution Center）- 密钥分发中心</strong>：
<ul>
<li>KDC 是 Kerberos 协议中的总称，由 AS 和 TGS 组成。KDC 通常指的是单个服务器，同时扮演 AS 和 TGS 的角色。</li>
</ul>
</li>
<li><strong>TGT（Ticket Granting Ticket）- 票据授权票据</strong>：
<ul>
<li>TGT 是 Kerberos 协议中的票据类型，用于访问 Kerberos 受信任的服务。获得 TGT 后，用户可以向 TGS 请求访问特定服务的票据。</li>
</ul>
</li>
<li><strong>TGS（Ticket Granting Server）- 票据授权服务器</strong>：
<ul>
<li>TGS 是 Kerberos 协议中的组件，负责颁发给用户用于访问特定服务的服务票据。用户通过提供 TGT 向 TGS 请求服务票据。</li>
</ul>
</li>
<li><strong>SS（Service Server）- 特定服务提供端</strong>：
<ul>
<li>SS 是 Kerberos 协议中的服务端，提供特定的网络服务，例如文件共享、电子邮件等。SS 验证客户端提供的服务票据，并在票据有效时提供服务。</li>
</ul>
</li>
</ol>
<p>参与认证的三个角色</p>
<ol>
<li>
<h3 id="客户端client"><a class="markdownIt-Anchor" href="#客户端client">#</a> <strong>客户端（Client）</strong>：</h3>
<ul>
<li>客户端是发起身份验证请求的一方。在 Kerberos 中，客户端通常是用户或者用户所在的计算机，它们希望获得访问域资源的权限。</li>
</ul>
</li>
<li>
<p><strong>服务端（Service Server）</strong>：</p>
<ul>
<li>服务端是接收身份验证请求的一方，并向客户端提供网络服务。服务端可以是任何提供网络服务的实体，如文件服务器、打印服务器、应用程序服务器等。</li>
</ul>
</li>
<li>
<p><strong>密钥分发中心（Key Distribution Center，KDC）</strong>：</p>
<ul>
<li>密钥分发中心是 Kerberos 协议的关键组件，负责处理身份验证请求并颁发票据。KDC 通常包含两个主要部分：
<ul>
<li><strong>AS（Authentication Server）</strong>：负责接收客户端的身份验证请求，并向客户端颁发 TGT（Ticket Granting Ticket，票据授权票据）。</li>
<li><strong>TGS（Ticket Granting Server）</strong>：负责接收客户端的 TGT，并向客户端颁发用于访问特定服务的服务票据。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="kerberos认证流程"><a class="markdownIt-Anchor" href="#kerberos认证流程">#</a> Kerberos 认证流程</h3>
<p><img data-src="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%86%85%E7%BD%91/%E5%9F%9F/image-20240305181912124.png" alt="image-20240305181912124"></p>
<ol>
<li><strong>客户端向域控制器请求访问服务器</strong>：客户端首先向域控制器（DC）发送一个请求，请求访问服务器。DC 通过查询活动目录（AD）来确定客户端是否可信。</li>
<li><strong>域控制器返回 TGT 给客户端</strong>：如果客户端被认证为可信，DC 会返回一个 Ticket Granting Ticket（TGT）给客户端。</li>
<li><strong>客户端使用 TGT 请求访问服务器</strong>：客户端持有 TGT，然后向 DC 请求访问服务器。Ticket Granting Service（TGS）通过检查客户端消息中的 TGT 来判断客户端是否有访问权限。</li>
<li><strong>如果客户端有访问权限，DC 会给客户端一个服务票据</strong>：如果客户端有访问权限，DC 会给客户端一个服务票据（Service Ticket，ST）。这个票据授予客户端访问服务器的权限。</li>
<li><strong>客户端使用服务票据访问服务器</strong>：客户端得到服务票据后，就可以用这个票据去访问服务器。这个票据只对这个服务器有效。</li>
<li><strong>服务器和客户端建立通信</strong>：最后，服务器和客户端建立通信。</li>
</ol>
<h3 id="详细流程"><a class="markdownIt-Anchor" href="#详细流程">#</a> 详细流程</h3>
<p>•ASREQ &amp; ASREP<br>
•TGSREQ &amp; TGSREP<br>
•AP-REQ &amp; AP-REP</p>
<h4 id="第一部分asreq-asrep"><a class="markdownIt-Anchor" href="#第一部分asreq-asrep">#</a> 第一部分 ASREQ &amp; ASREP</h4>
<p><img data-src="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%86%85%E7%BD%91/%E5%9F%9F/image-20240305182829923.png" alt="image-20240305182829923"></p>
<p>客户端向 KDC 发送一个 AS_REQ 请求里面信息包括 Kerberos 协议的版本号，用户名，请求类型，哈希值 NTLM-Hash 加密的时间戳</p>
<p>还有一些服务器信息，接着 AS 接收到请求后向 AD 查询是否有此用户信息有的话会拿出该用户的 NTLM-Hash 对加密的时间戳进行解密</p>
<p>五分钟之内预认证成功，认证通过后 KDC 生成两个东西分别是用于客户端和 KGS 之间通信的用客户端用户的 NTLM-HASH 加密的会话密钥 Session Key，和 Ticket Granting Ticket 票据授权票据</p>
<p>TGT：</p>
<p>AS 使用 KDC 账户（通常是 Krbtgt 用户，是域控制器创建时自动生成的特殊账户）的 NTLM-Hash 对 Session-key AS、时间戳和客户端信息等进行加密，这个加密过程确保了 TGT 的安全性和机密性，只有 KDC 账户的 NTLM-Hash 才能解密 TGT 并提取其中的信息，然后将加密后的 Session-key AS、时间戳、客户端信息以及 PAC 等信息组合起来，形成 TGT 因为使用服务端 Krbtgt 用户 NTLM-HASH 加密的所以客户端是解不开 TGT 的，TGT 一般为 8 小时有效期</p>
<p>PAC（Privilege Attribute Certificate）是 TGT 中的一个重要部分，包含了客户端的安全标识符（SID）、所在组等信息。PAC 用于后续的授权过程，以确保客户端在获取服务票据时具有适当的权限。</p>
<h4 id="第二部分tgsreq-tgsrep"><a class="markdownIt-Anchor" href="#第二部分tgsreq-tgsrep">#</a> 第二部分 TGSREQ &amp; TGSREP</h4>
<p><img data-src="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%86%85%E7%BD%91/%E5%9F%9F/image-20240305203212925.png" alt="image-20240305203212925"></p>
<p>该阶段是客户端和 TGS 的认证，通过认证以后获得 ST 服务票据</p>
<p>客户端接收到回复后获取到 Session key AS 和 TGT，接着将会用 NTLM-HASH 解密 session key AS 得到未加密 sessin key AS</p>
<p>然后将这些缓存到本地，客户端如果想获取什么服务就会拿着获取的 TGT 加上 Session-Key AS 加密时间戳、Client-info、Server-info 等数据组成 TGSREQ 去请求 TGS 购买 ST 服务票据</p>
<p>TGS 收到后</p>
<ol>
<li><strong>解密 TGT 并验证时间戳</strong>：
<ul>
<li>TGS 收到客户端的 TGSREQ 请求后，使用 Krbtgt 用户的 NTLM-hash 解密 TGT，得到其中的 Session-key AS、时间戳、Client-info 和 Server-info 等信息。</li>
<li>TGS 使用 Session-key AS 解密 TGT 中的信息，得到 Client-info 和时间戳。然后 TGS 将获取到的时间戳与当前时间进行比较，如果时间戳与当前时间相差太久，则需要重新进行身份验证。</li>
</ul>
</li>
<li><strong>验证客户端信息和权限</strong>：
<ul>
<li>TGS 进一步比较 TGT 中的 Client-info 与 TGSREQ 请求中的 Client 信息，确保两者一致性。</li>
<li>如果客户端信息验证通过，并且客户端有权限访问请求的服务，则认证成功。</li>
</ul>
</li>
<li><strong>生成 Session-key TGS 并加密</strong>：
<ul>
<li>如果身份验证成功，TGS 生成一个用于客户端和服务器之间通信的会话密钥，称为 Session-key TGS。</li>
<li>TGS 使用 Session-key AS 加密 Session-key TGS，并将其作为 TGS_REP 响应的一部分发送给客户端，确保通信的安全性。</li>
</ul>
</li>
<li><strong>生成 ST 并加密</strong>：
<ul>
<li>另一部分是 TGS 使用目标服务器（Server）的 NTLM-Hash 加密 Session-key TGS、时间戳以及 Client-info 等数据，生成服务票据（Service Ticket，ST）。</li>
<li>TGS 将这个 ST 作为 TGS_REP 响应的一部分发送给客户端</li>
</ul>
</li>
</ol>
<h4 id="第三部分ap-req-ap-rep"><a class="markdownIt-Anchor" href="#第三部分ap-req-ap-rep">#</a> 第三部分 AP-REQ &amp; AP-REP</h4>
<p>客户端在收到 TGS 的响应（TGS_REP）后，会使用它的会话密钥（Session-key AS）解密出新的会话密钥（Session-key TGS），并将其存储在本地。然后，当客户端需要访问服务时，它会使用新的会话密钥（Session-key TGS）加密其身份信息（Client-info）和时间戳，然后将其与服务票据（ST）一起发送给服务服务器。这个请求被称为 AP_REQ。</p>
<p>服务服务器在收到 AP_REQ 请求后，会使用它的 NTLM-Hash 解密服务票据（ST），得到新的会话密钥（Session-key TGS），然后使用这个密钥解密客户端的身份信息（Client-info）和时间戳。然后，服务服务器会将解密出的信息与服务票据（ST）中的信息进行比较，以验证客户端的身份。</p>
<p>一旦客户端通过了身份验证，服务服务器就会使用 PAC（Privilege Attribute Certificate）去询问域控制器（DC）客户端是否有访问服务的权限。域控制器在接收到 PAC 后，会解密 PAC，然后通过 PAC 中的 SID（Security Identifier）来判断客户端的用户组信息和权限。然后，域控制器会将结果返回给服务服务器，服务服务器再将这些信息与服务资源的访问控制列表（ACL）进行比较，最后决定是否给客户端提供服务。</p>
<p><img data-src="https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/%E5%86%85%E7%BD%91/%E5%9F%9F/image-20240305205417213.png" alt="image-20240305205417213"></p>
<h3 id="kerberos的安全问题"><a class="markdownIt-Anchor" href="#kerberos的安全问题">#</a> Kerberos 的安全问题</h3>
<ol>
<li><strong>票据伪造（Ticket Forgery）</strong>：攻击者可能会尝试伪造 Kerberos 票据，以获取未经授权的访问权限。这包括黄金票据和白银票据攻击，其中黄金票据是伪造 TGT（Ticket Granting Ticket）来获取对整个 Kerberos 域的访问权限，而白银票据则是伪造 TGS（Ticket Granting Service Ticket）以获取对特定服务的访问权限。</li>
<li><strong>中间人攻击（Man-in-the-Middle Attacks）</strong>：在 Kerberos 认证中，如果攻击者能够截获通信并伪装成合法用户与服务器进行通信，则可以执行中间人攻击。这种攻击可以导致信息泄露、数据篡改等问题。</li>
<li><strong>票据重放（Ticket Replay）</strong>：攻击者可能会捕获到有效的 Kerberos 票据，然后重放这些票据来获取访问权限。这种攻击可能导致身份伪造和未经授权的访问。</li>
</ol>
<h2 id="白银票据silver-tickets"><a class="markdownIt-Anchor" href="#白银票据silver-tickets">#</a> 白银票据（Silver Tickets）</h2>
<p>白银票据（Silver Ticket）是一种利用 Kerberos 认证系统的漏洞来实现非授权访问的攻击方式。在 Kerberos 协议中，PAC（Privilege Attribute Certificate，特权属性证书）是一个用于存储用户的安全信息、组成员身份以及授权信息的数据结构。PAC 由 Kerberos 服务器（KDC）在授予用户票据时生成，并附加在票据中。</p>
<p>攻击者通过获取用户的用户名和密码哈希值等信息，可以伪造 TGS（Ticket Granting Service Ticket）以请求访问网络资源。然而，TGS 本身并不包含 PAC。攻击者之所以能够成功利用白银票据攻击，是因为部分服务在处理 TGS 时并不验证 PAC，因此攻击者可以伪造 TGS，并不需要伪造 PAC 就能够获取非授权访问权限。</p>
<p>这种情况下，即使攻击者无法生成完整有效的 PAC，服务端仍然会授予其访问权限，因为服务端未对 PAC 进行验证。因此，白银票据攻击的成功前提之一就是目标服务对 PAC 的验证不严格，从而允许攻击者利用这一漏洞来获取非授权访问权限</p>
<p>白银票据就是伪造 ST 去请求服务而有些服务是不需要验证 PAC 的只需要有 ST 就可以，而制作 ST 是需要目标服务器（Server）的 NTLM-Hash</p>
<h3 id="制作条件"><a class="markdownIt-Anchor" href="#制作条件">#</a> 制作条件</h3>
<p>域名</p>
<p>域 sid</p>
<p>目标服务器名</p>
<p>服务账号的 NTML HASH</p>
<p>伪造的用户名</p>
<p>不需要验证 PAC 的服务</p>
<h3 id="mimikatz工具伪造"><a class="markdownIt-Anchor" href="#mimikatz工具伪造">#</a> mimikatz 工具伪造</h3>
<p><code>kerberos::golden /domain:域名 /sid:填sid /target:完整的域控名 /service:需要访问的服务 /rc4:服务账号NTMLHASH /user:用户名 /ptt</code></p>
<h2 id="黄金票据golden-ticket"><a class="markdownIt-Anchor" href="#黄金票据golden-ticket">#</a> 黄金票据 Golden ticket</h2>
<p>白银票据是伪造的 ST 而黄金票据伪造的是 TGT 就是 AS 返回给客户端的用来向 TGS 请求服务 ST 用的，获得 TGT 后，用户可以向 TGS 请求访问特定服务的票据。</p>
<p>TGT 使用 Krbtgt 用户 NTLM-HASH 加密的所以我们获取到 Krbtgt 用户 NTLM-HASH 就可以伪造 TGT 了</p>
<p>域名称</p>
<p>域的 SID 值</p>
<p>KRBTGT 账号的 HASH</p>
<p>伪造任意用户名</p>
<p>mimikatz 命令</p>
<p>kerberos::golden /admin: 用户名 /domain: 域名 /sid: 域 sid /krbtgt:NTLM HASH /ticket: 票据名称<br>
后面会详细讲</p>
<h2 id="白银票据黄金票据区别"><a class="markdownIt-Anchor" href="#白银票据黄金票据区别">#</a> 白银票据黄金票据区别</h2>
<h3 id="白银票据"><a class="markdownIt-Anchor" href="#白银票据">#</a> 白银票据</h3>
<p>白银票据需要服务器账号的 NTLM HASH</p>
<p>白银票据伪造的是 ST</p>
<p>白银票据只能访问部分不需要验证 PAC 的服务</p>
<p>白银票据不与 KDC 交互可以拿着伪造的 ST 去访问服务器</p>
<h3 id="黄金票据"><a class="markdownIt-Anchor" href="#黄金票据">#</a> 黄金票据</h3>
<p>黄金票据需要域 Krbtgt 用户 NTLM-HASH</p>
<p>黄金票据伪造的是 TGT</p>
<p>黄金票据可以访问所有服务</p>
<p>黄金票据不和 AS 交互但是和 KDC 交互因为要拿着伪造的 TGT 去 TGS 请求 ST</p>
</div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-03-07 19:52:09" itemprop="dateModified" datetime="2024-03-07T19:52:09+08:00">2024-03-07</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/assets/wechatpay.png" alt="云逸 微信支付"/><p>微信支付</p></div><div><img data-src="/assets/alipay.png" alt="云逸 支付宝"/><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>云逸<i class="ic i-at"><em>@</em></i>云逸'bolg</li><li class="link"><strong>本文链接：</strong><a href="http://gyzero.shop/2024/03/05/network-security/neiwang/win%E5%8D%8F%E8%AE%AE/" title="win协议认证知识">http://gyzero.shop/2024/03/05/network-security/neiwang/win协议/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/03/03/network-security/neiwang/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;tuchuang-1309689803.cos.ap-nanjing.myqcloud.com&#x2F;gyzero&#x2F;oo.jpg" title="内网信息收集"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>内网安全</span><h3>内网信息收集</h3></a></div><div class="item right"></div></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ntlm%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text"> NTLM 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm-hash"><span class="toc-number">1.1.</span> <span class="toc-text"> NTLM HASH</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text"> 本地认证流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm%E8%AE%A4%E8%AF%81%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text"> NTLM 认证详细流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%85%88%E5%8D%8F%E5%95%86"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 第一步先协商</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E6%8C%91%E6%88%98%E5%93%8D%E5%BA%94"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 第二步挑战 &#x2F; 响应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlmv1%E5%92%8Cv2%E5%8C%BA%E5%88%AB"><span class="toc-number">1.4.</span> <span class="toc-text"> NTLMv1 和 v2 区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ntlm-hash%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text"> NTLM-HASH 的安全问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kerberos%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.</span> <span class="toc-text"> Kerberos 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos%E4%B8%80%E4%BA%9B%E6%9C%AF%E8%AF%AD"><span class="toc-number">2.1.</span> <span class="toc-text"> kerberos 一些术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AFclient"><span class="toc-number">2.2.</span> <span class="toc-text"> 客户端（Client）：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text"> Kerberos 认证流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text"> 详细流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86asreq-asrep"><span class="toc-number">2.4.1.</span> <span class="toc-text"> 第一部分 ASREQ &amp; ASREP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86tgsreq-tgsrep"><span class="toc-number">2.4.2.</span> <span class="toc-text"> 第二部分 TGSREQ &amp; TGSREP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86ap-req-ap-rep"><span class="toc-number">2.4.3.</span> <span class="toc-text"> 第三部分 AP-REQ &amp; AP-REP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">2.5.</span> <span class="toc-text"> Kerberos 的安全问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AEsilver-tickets"><span class="toc-number">3.</span> <span class="toc-text"> 白银票据（Silver Tickets）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text"> 制作条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mimikatz%E5%B7%A5%E5%85%B7%E4%BC%AA%E9%80%A0"><span class="toc-number">3.2.</span> <span class="toc-text"> mimikatz 工具伪造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AEgolden-ticket"><span class="toc-number">4.</span> <span class="toc-text"> 黄金票据 Golden ticket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%E5%8C%BA%E5%88%AB"><span class="toc-number">5.</span> <span class="toc-text"> 白银票据黄金票据区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text"> 白银票据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">5.2.</span> <span class="toc-text"> 黄金票据</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/" rel="bookmark" title="域环境">域环境</a></li><li ><a href="/2023/11/09/network-security/neiwang/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/" rel="bookmark" title="Windows提权">Windows提权</a></li><li ><a href="/2023/11/10/network-security/neiwang/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83/" rel="bookmark" title="linux提权">linux提权</a></li><li ><a href="/2024/03/03/network-security/neiwang/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="bookmark" title="内网信息收集">内网信息收集</a></li><li  class="active"><a href="/2024/03/05/network-security/neiwang/win%E5%8D%8F%E8%AE%AE/" rel="bookmark" title="win协议认证知识">win协议认证知识</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="云逸" data-src="/assets/avatar.jpg"/><p class="name" itemprop="name">云逸</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span><span class="name">分类</span></a></div></nav><div class="social"><a href="https://gyzero1.github.io/" class="item github" rel="noopener" title="https:&#x2F;&#x2F;gyzero1.github.io&#x2F;" target="_blank"><i class="ic i-github"></i></a><a href="https://about.me/gyzero" class="item about" rel="noopener" title="https:&#x2F;&#x2F;about.me&#x2F;gyzero" target="_blank"><i class="ic i-address-card"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/03/03/network-security/neiwang/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" title="分类于编程语言">编程语言</a><i class="ic i-angle-right"></i><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/" title="分类于php基础">php基础</a></div><span><a href="/2023/12/12/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/PHP%E5%B8%B8%E9%87%8F/PHP%E5%B8%B8%E9%87%8F/">PHP常量</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/" title="分类于web安全">web安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/Basic-vulnerabilities/" title="分类于基础漏洞">基础漏洞</a></div><span><a href="/2023/11/01/%E6%BC%8F%E6%B4%9E/xss%E6%BC%8F%E6%B4%9E/">xss漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/Cloud-Security/" title="分类于云安全">云安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/Cloud-Security/docker/" title="分类于docker">docker</a></div><span><a href="/2023/10/27/%E6%BC%8F%E6%B4%9E/docker%E9%80%83%E9%80%B8/">docker逃逸</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/neiwang/" title="分类于内网安全">内网安全</a></div><span><a href="/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/">域环境</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" title="分类于编程语言">编程语言</a><i class="ic i-angle-right"></i><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/" title="分类于php基础">php基础</a></div><span><a href="/2023/12/12/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/PHP%E8%BF%90%E7%AE%97%E7%AC%A6/PHP%E8%BF%90%E7%AE%97%E7%AC%A6/">PHP运算符</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/neiwang/" title="分类于内网安全">内网安全</a></div><span><a href="/2023/11/10/network-security/neiwang/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83/">linux提权</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/sqls/" title="分类于数据库">数据库</a></div><span><a href="/2023/11/01/sqls/mysql/mysql%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/">mysql增删改查</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/" title="分类于web安全">web安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/Basic-vulnerabilities/" title="分类于基础漏洞">基础漏洞</a></div><span><a href="/2023/11/05/%E6%BC%8F%E6%B4%9E/csrf%E6%BC%8F%E6%B4%9E/">CSRF漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/network-security/" title="分类于网络安全">网络安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/" title="分类于web安全">web安全</a><i class="ic i-angle-right"></i><a href="/categories/network-security/web-security/Basic-vulnerabilities/" title="分类于基础漏洞">基础漏洞</a></div><span><a href="/2023/11/09/%E6%BC%8F%E6%B4%9E/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">文件上传漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" title="分类于编程语言">编程语言</a><i class="ic i-angle-right"></i><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/" title="分类于php基础">php基础</a></div><span><a href="/2023/11/16/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php%E5%9F%BA%E7%A1%80/php%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/php%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">php数据类型</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">云逸 @ 云逸'bolg</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">183k 字</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">2:46</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
        path: `2024/03/05/network-security/neiwang/win协议/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,
    chart: false,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.15.2/contrib/copy-tex.min.js" async></script><script src="/js/app.js?v=0.3.6"></script></body></html>